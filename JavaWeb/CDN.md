## CDN

#### 简介

- CDN的全称是Content Delivery Network，即内容分发网络
- CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率
- CDN的关键技术：内容存储、分发技术



#### 优点

- 节省骨干网带宽，减少带宽需求量
- 提供服务器端加速，解决由于用户访问量大造成的服务器过载问题
- 服务商能使用 Web Cache 技术在本地缓存用户访问过的Web页面和对象，实现相同对象的访问无须占用主干的出口带宽，并提高用户访问因特网页面的相应时间的需求
- 能克服网站分布不均的问题，并且能降低网站自身建设和维护成本
- 降低“通信风暴”的影响，提高网络访问的稳定性



#### 基本原理

- 广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中
- 在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求



#### 基本思路

- 尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定
- 通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上
- 目的是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度



#### 关键技术

- **内容发布**
  - 借助于建立索引、缓存、流分裂、组播（Multicast）等技术，将内容发布或投递到距离用户最近的远程服务点（POP）处
  - 内容分发包含从内容源到 CDN 边缘的 Cache 的过程。从实现上，有两种主流的内容分发技术：PUSH 和 PULL
    - PUSH 是一种主动分发的技术。PUSH 由内容管理系统发起，将内容从源或者中心媒体资源库分发到各边缘的 Cache节点。分发的协议可以采用 Http/ftp 等，通过PUSH分发的内容一般是比较热点的内容，这些内容通过 PUSH 方式预分发（ Preload）到边缘Cache，可以实现有针对的内容提供。对于 PUSH 分发需要考虑的主要问题是分发策略，即在什么时候分发什么内容
    -  PULL 是一种被动的分发技术，PULL分发通常由用户请求驱动。当用户请求的内容在本地的边缘 Cache 上不存在（未命中）时， Cache 启动 PUL 方法从内容源或者其他 CDN 节点实时获取内容
  - 一般来说，内容分发可以由 CP（内容提供商）或者 CDN 内容管理员人工确定，也可以通过智能的方式决定，即所谓的智能分发，它根据用户访问的统计信息，以及预定义的内容分发的规则

- **内容路由**
  - 它是整体性的网络负载均衡技术，通过内容路由器中的重定向（DNS）机制，在多个远程 POP 上均衡用户的请求，以使用户请求得到最近内容源的响应
  - CDN 负载均衡系统实现 CDN 的内容路由功能。它的作用是将用户的请求导向整个 CDN 网络中的最佳节点，最佳节点的选定可以根据多种策略，例如距离最近、节点负载最轻等。
  - 负载均衡系统是整个 CDN 的核心，负载均衡的准确性和效率直接决定了整个 CDN 的效率和性能
  - 通常负载均衡可以分为两个层次：全局负载均衡（GSLB）和本地负载均衡（SLB）
    - 全局负载均衡：在整个网络范围内将用户的请求定向到最近的节点（或者区域）
    - 本地负载均衡：一般局限于一定的区域范围内，其目标是在特定的区域范围内寻找一台最适合的节点提供服务

- **内容存储**
  - 对于内容源的存储，由于内容的规模比较大（通常可以达到几个甚至几十个TB），而且内容的吞吐量较大，因此，通常采用海量存储架构，如 NAS 和 SON
  - 对于在  Cache 节点中的存储，需要考虑的因素包括功能和性能两个方面:功能上包括对各种内容格式的支持，对部分缓存的支持，在性能上包括支持的容量、多文件吞吐率、可靠性、稳定性
  - 目前，多数存储系统都采用了独立磁盘冗余阵列（RAID）技术进行可靠存储。但是不同设备使用的 RAID 方式各有不同

- **内容管理**
  - 通过内部和外部监控系统，获取网络部件的状况信息，测量内容发布的端到端性能（如包丢失、延时、平均带宽、启动时间、帧速率等），保证网络处于最佳的运行状态
  - CDN 内容管理重点强调内容进人 Cache 点后的内容管理，称其为本地内容管理
    - 本地内容管理主要针对一个 ODN 节点（有多个 CDN Cache设备和一个SLB设备构成）进行
    - 本地内容管理的主要目标是提高内容服务的效率，提高本地节点的存储利用率
    - 可以在CDN节点实现基于内容感知的调度，通过内容感知的调度，可以避免将用户重定向到没有该内容的 Cache设备上，从而提高负载均衡的效率
    - 可以有效实现在ODN节点内容的存储共享，提高存储空间的利用率